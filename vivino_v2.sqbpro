<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="/Users/dastanmirzayev/VIVINO/Vivino-market-analysis/vivino_v2.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="2074"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,8:mainvintages"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="BEST_OF_THE_BEST" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="73"/><column index="2" value="147"/><column index="3" value="129"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="BIG_TABLE" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="4" mode="1"/></sort><column_widths><column index="1" value="248"/><column index="2" value="300"/><column index="3" value="213"/><column index="4" value="226"/><column index="6" value="147"/><column index="7" value="129"/><column index="8" value="300"/><column index="9" value="97"/><column index="10" value="97"/><column index="11" value="97"/><column index="13" value="97"/><column index="14" value="191"/><column index="15" value="52"/><column index="16" value="300"/><column index="17" value="126"/><column index="18" value="54"/><column index="19" value="126"/><column index="20" value="131"/><column index="21" value="114"/><column index="22" value="119"/><column index="23" value="141"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="GRAPPY" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="42"/><column index="2" value="166"/><column index="3" value="49"/><column index="4" value="126"/><column index="5" value="87"/><column index="6" value="119"/></column_widths><filter_values><column index="3" value="2"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Priority_country" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="320"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="countries" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="54"/><column index="2" value="126"/><column index="3" value="131"/><column index="4" value="196"/><column index="5" value="168"/><column index="6" value="141"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="grapes" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="42"/><column index="2" value="166"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="highlights" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="300"/><column index="2" value="147"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="keywords" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="149"/><column index="2" value="177"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="keywords_wine" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="113"/><column index="2" value="81"/><column index="3" value="116"/><column index="4" value="132"/><column index="5" value="63"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="most_used_grapes_per_country" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="171"/><column index="2" value="126"/><column index="3" value="87"/><column index="4" value="119"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="regions" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="300"/><column index="3" value="126"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="top_3" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="33"/><column index="2" value="166"/><column index="3" value="49"/><column index="4" value="126"/><column index="5" value="87"/><column index="6" value="119"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="toplists" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="91"/><column index="2" value="615"/><column index="3" value="126"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="vintage_toplists_rankings" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="1"/></sort><column_widths><column index="1" value="41"/><column index="2" value="189"/><column index="3" value="147"/><column index="4" value="57"/><column index="5" value="135"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="vintages" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="4" mode="1"/></sort><column_widths><column index="1" value="93"/><column index="2" value="300"/><column index="3" value="83"/><column index="4" value="266"/><column index="5" value="129"/><column index="6" value="54"/><column index="7" value="110"/><column index="8" value="202"/><column index="9" value="232"/><column index="10" value="162"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="wineries" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="1"/></sort><column_widths><column index="1" value="73"/><column index="2" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="wineries_and_wines" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="1" mode="0"/></sort><column_widths><column index="1" value="73"/><column index="2" value="300"/><column index="3" value="83"/><column index="4" value="300"/><column index="6" value="93"/><column index="8" value="147"/><column index="9" value="129"/><column index="10" value="300"/><column index="11" value="97"/><column index="12" value="97"/><column index="13" value="97"/><column index="15" value="97"/><column index="16" value="191"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="wines" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="5" mode="0"/></sort><column_widths><column index="1" value="83"/><column index="2" value="300"/><column index="4" value="93"/><column index="5" value="166"/><column index="6" value="147"/><column index="7" value="129"/><column index="8" value="300"/><column index="9" value="97"/><column index="10" value="97"/><column index="11" value="97"/><column index="13" value="97"/><column index="14" value="191"/></column_widths><filter_values><column index="5" value="52"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1">--We want to highlight 10 wines to increase our sales, which ones should we choose and why?

CREATE TABLE  highlights AS

SELECT name, ratings_average
FROM wines
ORDER BY ratings_count DESC, ratings_average DESC
LIMIT 10;


--We have a marketing budget for this year, which country should we prioritise and why?

unt) FROM countries );

Drop TABLE Priority_country

CREATE TABLE Priority_country AS

SELECT name
FROM countries
WHERE  wineries_count = (SELECT min(wineries_count) FROM countries)
  AND wines_count = (SELECT min(wines_count) FROM countries)
  AND users_count = (SELECT min(users_count) FROM countries);

  
  --We would like to give a price to the best winery, which one should we choose and why?
  
CREATE TABLE wineries_and_wines AS

SELECT *
FROM wineries
JOIN wines ON wineries.id = winery_id;

CREATE TABLE BEST_OF_THE_BEST as
SELECT name, ratings_average, ratings_count
FROM wineries_and_wines
WHERE ratings_count = (SELECT max(ratings_count) FROM wineries_and_wines);
 

--We has detected that a big cluster of customers like a specific combination of tastes. 
--We have identified few primary keywords that matches this and we would like you to find all the wines
-- that have those keywords. To ensure accuracy of our selection, ensure that more than 10 users confirmed those keywords. Also,
-- identify the flavor_groups related to those keywords.
--Coffee
--Toast
--Green apple
--cream
--citrus

CREATE TABLE DETECTIVE as 

SELECT name
FROM keywords
WHERE name IN ('coffee', 'toast', 'green apple', 'cream', 'citrus');



--We would like to do a selection of wines that are easy to find all over the world. 
--Find the top 3 most common grape all over the world and for each grape, give us the the 5 best rated wines.

SELECT wines.name AS wine_name, grapes.name AS grape_name, countries.wines_count ,  ratings_count
FROM wines
JOIN regions ON wines.region_id = regions.id
JOIN countries ON regions.country_code = countries.code
JOIN most_used_grapes_per_country AS m ON m.country_code = countries.code
JOIN grapes ON grapes.id = m.grape_id
GROUP BY countries.wines_count, ratings_count
order by countries.wines_count DESC, ratings_count DESC
LIMIT 3;


--We would to give create a country leaderboard, 
--give us a visual that shows the average wine rating for each country. 





SELECT  wines.name as  wine_name, countries.name  as  country_name,  wines.ratings_average 
From wines
join regions on wines.region_id = regions.id
JOIN countries on regions.country_code = countries.code
GROUP BY country_name, ratings_average
ORDER BY ratings_average DESC

--Do the same for the vintages.

SELECT  vintages.name as  vintage_wine_name, countries.name  as  country_name,  vintages.ratings_average  as vintages_ratings_average 
From vintages
JOIN wines on vintages.wine_id = wines.id
join regions on wines.region_id = regions.id
JOIN countries on regions.country_code = countries.code
GROUP BY country_name, vintages_ratings_average 
ORDER BY vintages_ratings_average DESC





</sql><current_tab id="0"/></tab_sql></sqlb_project>
